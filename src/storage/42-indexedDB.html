<!DOCTYPE html>
<html>
<head>
<title>Chapter 23, 离线应用 与 客户端存储</title>
</head>
<body>
<IMG src="images/t01.jpg">
<script type="text/javascript">
/**
 * 23.3.4 IndexedDB
 *  Indexed Database API: 是在浏览器中保存结构化数据的一种数据库,
 *  代替 Web SQL Database API
 *  对象保存数据
 *  errorCode:
 *      IDBDatabaseException.UNKOWN_ERR(1): 意外错误,无法归类
 *      IDBDatabaseException.NON_TRANSIENT_ERR(2):操作不合法
 *      IDBDatabaseException.NOT_FOUND_ERR(3):未发现要操作的数据库
 *      IDBDatabaseException.CONSTRAINT_ERR(4):违返了数据库约束
 *      IDBDatabaseException.DATA_ERR(5):提供给事务的数据不能满足要求
 *      IDBDatabaseException.NOT_ALLOW_ERR(6):操作不合法
 *      IDBDatabaseException.TRANSACTION_INACTIVE_ERR(7):试图重用已完成的事务
 *      IDBDatabaseException.ABORT_ERR(8):请求中断,未成功
 *      IDBDatabaseException.READ_ONYL_ERR(9):试图在只读模式下写入或修改数据
 *      IDBDatabaseException.TIMEOUT_ERR(10):在有效时间内未完成操作
 *      IDBDatabaseException.QUOTA_ERR(11):磁盘空间不足
 *
 */
//    var indexedDB = window.indexedDB || window.msIndexedDB
//            || window.mozIndexedDB || window.webkitIndexedDB;//兼容各个浏览器
//    var request, database;
//    request = indexedDB.open("admin");
//    request.onerror = function (event) {
//        console.log("Something bad happend while trying to open: " +
//                event.target.errorCode);
//    };
//    request.onsuccess = function (event) {
//        database = event.target.result;//数据库实例对象
//        initializeDatabase();
//    };

//    function initializeDatabase() {  //指定版本号
//        if (database.version != "1.0") {
//            request = database.setVersion("1.0");
//            request.onerror = function (event) {
//                console.log("Something bad happened while trying to set version: "
//                        + event.target.errorCode);
//            };
//            request.onsuccess = function (event) {
//                console.log("Database initialization complete. Database name: "
//                        + database.name + ", Version: " + database.version);
//            };
//        } else {
//            console.log("Database already initialized. Database name: "
//                    + database.name + ", Version: " + database.version);
//        }
//    }

/** 
 * 2.对象存储空间
 */
//    var indexedDB = window.indexedDB || window.msIndexedDB || window.mozIndexedDB || window.webkitIndexedDB,
//            request,
//            requests = [],
//            store,
//            database,
//            users = [
//                {
//                    username: "007",
//                    firstName: "James",
//                    lastName: "Bond",
//                    password: "foo"
//                },
//                {
//                    username: "ace",
//                    firstName: "John",
//                    lastName: "Smith",
//                    password: "bar"
//                }
//            ];
//
//    request = indexedDB.open("example");
//    request.onerror = function (event) {
//        console.log("Something bad happened while trying to open: " + event.target.errorCode);
//    };
//    request.onsuccess = function (event) {
//        database = event.target.result;
//        initializeDatabase();
//    };
//
//    function initializeDatabase() {
//        if (database.version != "1.0") {
//            request = database.setVersion("1.0");
//            store = database.createObjectStore("users", { keyPath: "username" });
//            var i = 0,
//                    len = users.length;
//
//            while (i < len) {
//                store.add(users[i++]);
//                request.onerror = function (event) {
//                    console.log("Something bad happened while trying to set version: " + event.target.errorCode);
//                };
//                request.onsuccess = function (event) {
//                    console.log("Database initialized for first time. Database name: " + database.name + ", Version: " + database.version);
//                };
//                requests.push(request);
//            }
//        } else {
//            console.log("Database already initialized. Database name: " + database.name + ", Version: " + database.version);
//            request = database.transaction("users").objectStore("users").get("007");
//            request.onsuccess = function (event) {
//                console.log(event.target.result.firstName);
//            };
//        }
//    }

/**3.事务
 * 4.使用游标
 *
 */
</script>



</body>
</html>
